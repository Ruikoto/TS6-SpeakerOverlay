<Window x:Class="TS6_SpeakerOverlay.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:TS6_SpeakerOverlay.ViewModels"
        mc:Ignorable="d"
        Title="TS6 Overlay"
        Height="Auto"
        MinHeight="80"
        Width="300"
        SizeToContent="Height"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        Topmost="True"
        ShowInTaskbar="False"
        ResizeMode="NoResize"
        FontFamily="Microsoft YaHei">

    <!-- 绑定 ViewModel -->
    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>

    <Grid x:Name="MainGrid" Background="Transparent">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- 工具栏：拖拽和锁定按钮 -->
        <StackPanel x:Name="ToolBar" Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Left" Margin="5,5,5,0">
            <StackPanel.Style>
                <Style TargetType="StackPanel">
                    <Setter Property="Opacity" Value="0"/>
                    <Style.Triggers>
                        <!-- 锁定时隐藏但仍占据空间 -->
                        <DataTrigger Binding="{Binding IsOverlayLocked}" Value="True">
                            <Setter Property="Visibility" Value="Hidden"/>
                        </DataTrigger>
                        <!-- 未锁定且鼠标悬停时显示 -->
                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding IsOverlayLocked}" Value="False"/>
                                <Condition Binding="{Binding ElementName=MainGrid, Path=IsMouseOver}" Value="True"/>
                            </MultiDataTrigger.Conditions>
                            <Setter Property="Opacity" Value="1"/>
                        </MultiDataTrigger>
                    </Style.Triggers>
                </Style>
            </StackPanel.Style>

            <!-- 拖拽按钮 -->
            <Border x:Name="DragHandle"
                    Background="#AA000000" CornerRadius="5" Padding="8,4" Margin="0,0,5,0"
                    BorderThickness="1" BorderBrush="#33FFFFFF"
                    Cursor="SizeAll"
                    MouseLeftButtonDown="DragHandle_MouseDown"
                    ToolTip="拖拽移动窗口">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="⣿" Foreground="#FFAB53" FontSize="14" FontWeight="Medium" Margin="0,-3,5,0" VerticalAlignment="Center"/>
                    <TextBlock Text="拖拽" Foreground="#FFAB53" FontSize="12" FontWeight="Medium" VerticalAlignment="Center"/>
                </StackPanel>
            </Border>

            <!-- 锁定按钮 -->
            <Border Background="#AA000000" CornerRadius="5" Padding="8,4"
                    BorderThickness="1" BorderBrush="#33FFFFFF"
                    Cursor="Hand"
                    MouseLeftButtonDown="LockButton_Click"
                    ToolTip="点击锁定并启用鼠标穿透">
                <Border.Style>
                    <Style TargetType="Border">
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#CC000000"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="🔒" Foreground="#4FCD8E" FontSize="14" FontWeight="Medium" Margin="0,-1,5,0" VerticalAlignment="Center"/>
                    <TextBlock Text="锁定" Foreground="#4FCD8E" FontSize="12" FontWeight="Medium" VerticalAlignment="Center"/>
                </StackPanel>
            </Border>
        </StackPanel>

        <!-- 通知区域 -->
        <ItemsControl ItemsSource="{Binding Notifications}" Grid.Row="1" Margin="5,0">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <StackPanel VerticalAlignment="Top"/>
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <Border Background="#D9000000" CornerRadius="6" Margin="0,2,0,0" Padding="12,6" BorderThickness="1" BorderBrush="#33FFFFFF">
                        <Border.Triggers>
                            <EventTrigger RoutedEvent="Loaded">
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.25"/>
                                        <ThicknessAnimation Storyboard.TargetProperty="Margin" From="0,-10,0,0" To="0,2,0,0" Duration="0:0:0.25" DecelerationRatio="0.9"/>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                        </Border.Triggers>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding Icon}" Foreground="{Binding Color}" FontSize="16" Margin="0,0,8,0" FontWeight="Medium" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding Message}" Foreground="White" FontSize="13" FontWeight="Medium" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>

        <!-- 用户列表 -->
        <Border Grid.Row="2" Background="#01000000" CornerRadius="10">
            <ItemsControl ItemsSource="{Binding Users}" Margin="5,2,5,0">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border x:Name="UserCard"
                                Background="#99000000"
                                CornerRadius="5"
                                Margin="0,2"
                                Padding="10,5"
                                BorderThickness="2"
                                BorderBrush="Transparent"
                                HorizontalAlignment="Left">
                            <StackPanel Orientation="Horizontal">
                                <Ellipse x:Name="StatusLight" Width="10" Height="10" Fill="Gray" Margin="0,0,8,0"/>
                                <TextBlock Text="{Binding Name}"
                                           Foreground="White"
                                           FontSize="14"
                                           FontWeight="Bold"/>
                            </StackPanel>
                        </Border>

                        <DataTemplate.Triggers>
                            <DataTrigger Binding="{Binding IsTalking}" Value="True">
                                <Setter TargetName="UserCard" Property="BorderBrush" Value="#4FCD8E"/>
                                <Setter TargetName="StatusLight" Property="Fill" Value="#4FCD8E"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding IsTalking}" Value="False">
                                <Setter TargetName="UserCard" Property="Opacity" Value="0.5"/>
                                <Setter TargetName="UserCard" Property="BorderBrush" Value="Transparent"/>
                            </DataTrigger>
                        </DataTemplate.Triggers>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Border>
    </Grid>
</Window>